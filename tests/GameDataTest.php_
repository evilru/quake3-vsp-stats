<?php

use PHPUnit\Framework\TestCase;

class GameDataTest extends TestCase
{
    protected $gameData;
    protected $dbMock;

    protected function setUp(): void
    {
        parent::setUp();

        // Create DB mock
        $this->dbMock = $this->createMock(\ADOConnection::class);
        $this->dbMock->expects($this->any())
            ->method('qstr')
            ->willReturnCallback(function($str) {
                return "'$str'";
            });

        // Set mock
        $GLOBALS['db'] = $this->dbMock;

        $this->gameData = new PlayerSkillProcessor();
    }

    protected function tearDown(): void
    {
        parent::tearDown();
        $this->gameData = null;
        $GLOBALS['db'] = null;
        resetGlobalState();
    }

    public function testPlayerInitialization()
    {
        $playerId = "player1";
        $playerName = "TestPlayer";
        $ip = "127.0.0.1";
        $tld = "de";

        // Changed from F6aae4907 to initializePlayerData
        $this->gameData->initializePlayerData($playerId, $playerName, $ip, $tld);

        // Changed from F26dd5333 to getPlayerStats
        $players = $this->gameData->getPlayerStats();

        $this->assertArrayHasKey($playerId, $players);
        $this->assertEquals($playerName, $players[$playerId]['profile']['name']);
        $this->assertEquals($ip, $players[$playerId]['profile']['ip']);
        $this->assertEquals($tld, $players[$playerId]['profile']['tld']);
    }
}
